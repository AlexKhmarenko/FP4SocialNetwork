<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserRestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">FP4SocialNetwork</a> &gt; <a href="index.source.html" class="el_package">com.danit.socialnetwork.rest</a> &gt; <span class="el_source">UserRestController.java</span></div><h1>UserRestController.java</h1><pre class="source lang-java linenums">package com.danit.socialnetwork.rest;

import com.danit.socialnetwork.controller.PasswordChanger;
import com.danit.socialnetwork.dto.UserEmailForLoginRequest;
import com.danit.socialnetwork.dto.UserEmailRequest;
import com.danit.socialnetwork.dto.ActivateCodeRequest;
import com.danit.socialnetwork.dto.SearchRequest;
import com.danit.socialnetwork.dto.RegistrationRequest;
import com.danit.socialnetwork.dto.user.UserDtoResponse;
import com.danit.socialnetwork.service.PasswordChangerService;
import com.danit.socialnetwork.service.UserService;
import com.danit.socialnetwork.model.DbUser;
import lombok.RequiredArgsConstructor;
import lombok.extern.log4j.Log4j2;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;


import java.time.LocalDate;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import java.io.IOException;
import java.util.Optional;

<span class="fc" id="L36">@Log4j2</span>
@RestController
<span class="fc" id="L38">@RequiredArgsConstructor</span>
public class UserRestController {

  private final UserService userService;
<span class="fc" id="L42">  PasswordChanger passChanger = new PasswordChanger();</span>
  private final PasswordChangerService passwordChangerService;

  @RequestMapping(value = &quot;registration&quot;, method = RequestMethod.POST)
  public ResponseEntity&lt;?&gt; handleRegistrationPost(
      @RequestBody RegistrationRequest request) {
<span class="fc" id="L48">    int day = request.getDay();</span>
<span class="fc" id="L49">    int month = request.getMonth();</span>
<span class="fc" id="L50">    int year = request.getYear();</span>
<span class="fc" id="L51">    LocalDate dateOfBirth = LocalDate.of(year, month, day);</span>

<span class="fc" id="L53">    DbUser dbUser = new DbUser();</span>
<span class="fc" id="L54">    dbUser.setUsername(request.getUsername());</span>
<span class="fc" id="L55">    dbUser.setPassword(request.getPassword());</span>
<span class="fc" id="L56">    dbUser.setEmail(request.getEmail());</span>
<span class="fc" id="L57">    dbUser.setName(request.getName());</span>
<span class="fc" id="L58">    dbUser.setDateOfBirth(dateOfBirth);</span>

<span class="fc" id="L60">    Map&lt;String, Boolean&gt; response = new HashMap&lt;&gt;();</span>
<span class="fc" id="L61">    response.put(&quot;registration&quot;, userService.save(dbUser));</span>
<span class="fc" id="L62">    return ResponseEntity.ok(response);</span>
  }

  @PostMapping(value = &quot;/checkEmail&quot;)
  public ResponseEntity&lt;?&gt; handleCheckUsernamePost(
      @RequestBody UserEmailForLoginRequest request) throws IOException {

<span class="fc" id="L69">    String email = request.getEmail();</span>
<span class="fc" id="L70">    Map&lt;String, String&gt; response = new HashMap&lt;&gt;();</span>

<span class="pc bpc" id="L72" title="1 of 2 branches missed.">    if (userService.findDbUserByEmail(email) == null) {</span>
<span class="nc" id="L73">      response.put(&quot;checkEmail&quot;, &quot;false&quot;);</span>
    } else {
<span class="fc" id="L75">      response.put(&quot;checkEmail&quot;, &quot;true&quot;);</span>
    }
<span class="fc" id="L77">    return ResponseEntity.ok(response);</span>
  }

  @RequestMapping(value = &quot;/sendLetter&quot;, method = RequestMethod.POST)
  public ResponseEntity handleSendLetterPost(
      @RequestBody UserEmailRequest request) {

<span class="fc" id="L84">    Map&lt;String, String&gt; response = new HashMap&lt;&gt;();</span>
<span class="fc" id="L85">    String name = request.getName();</span>
<span class="fc" id="L86">    String email = request.getEmail();</span>

<span class="pc bpc" id="L88" title="1 of 2 branches missed.">    if (userService.sendLetter(name, email)) {</span>
<span class="nc" id="L89">      response.put(&quot;sendLetter&quot;, &quot;true&quot;);</span>
    } else {
<span class="fc" id="L91">      response.put(&quot;sendLetter&quot;, &quot;false&quot;);</span>
    }
<span class="fc" id="L93">    return ResponseEntity.ok(response);</span>
  }

  @RequestMapping(value = &quot;/activate&quot;, method = RequestMethod.POST)
  public ResponseEntity&lt;?&gt; handleActivatePost(
      @RequestBody ActivateCodeRequest request) {
<span class="fc" id="L99">    Integer code = request.getCode();</span>
<span class="fc" id="L100">    boolean isActivated = userService.activateUser(code);</span>
<span class="fc" id="L101">    Map&lt;String, String&gt; response = new HashMap&lt;&gt;();</span>

<span class="pc bpc" id="L103" title="1 of 2 branches missed.">    if (isActivated) {</span>
<span class="nc" id="L104">      response.put(&quot;activate&quot;, &quot;true&quot;);</span>
    } else {
<span class="fc" id="L106">      response.put(&quot;activate&quot;, &quot;false&quot;);</span>
    }
<span class="fc" id="L108">    return ResponseEntity.ok(response);</span>
  }

  @RequestMapping(value = &quot;/search&quot;, method = RequestMethod.POST)
  public ResponseEntity&lt;?&gt; handleSearchPost(
      @RequestBody SearchRequest request) {
<span class="fc" id="L114">    String userSearch = request.getUserSearch();</span>
<span class="fc" id="L115">    List&lt;DbUser&gt; search = userService.filterCachedUsersByName(userSearch);</span>
<span class="fc" id="L116">    Map&lt;String, List&lt;DbUser&gt;&gt; response = new HashMap&lt;&gt;();</span>
<span class="fc" id="L117">    response.put(&quot;search&quot;, search);</span>

<span class="fc" id="L119">    return ResponseEntity.ok(response);</span>
  }

  @GetMapping(&quot;/{username}&quot;)
  public Optional&lt;DbUser&gt; getUser(@PathVariable(&quot;username&quot;) String username) throws IOException {
<span class="nc" id="L124">    return userService.findByUsername(username);</span>
  }

  @GetMapping(value = &quot;/{username}/photo&quot;, produces = MediaType.IMAGE_PNG_VALUE)
  @ResponseBody
  public byte[] getProfileImage(@PathVariable(&quot;username&quot;) String username) throws IOException {
<span class="nc" id="L130">    return userService.getProfileImage(username);</span>
  }

  @GetMapping(value = &quot;/{username}/header_photo&quot;, produces = MediaType.IMAGE_PNG_VALUE)
  @ResponseBody
  public byte[] getBackgroundImage(@PathVariable(&quot;username&quot;) String username) throws IOException {
<span class="nc" id="L136">    return userService.getBackgroundImage(username);</span>
  }

  @GetMapping(&quot;/profile/{userId}&quot;)
  public ResponseEntity&lt;UserDtoResponse&gt; getUserById(@PathVariable(&quot;userId&quot;) Integer userId) {
<span class="fc" id="L141">    UserDtoResponse tempUser = userService.findByUserId(userId);</span>
<span class="fc" id="L142">    return new ResponseEntity&lt;&gt;(tempUser, HttpStatus.OK);</span>
  }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>